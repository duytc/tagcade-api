parameters:
    tagcade_app.event.update_cache: tagcade_app.event.update_cache

services:

    tagcade.legacy.cache.tag.redis_namespace_cache:
        class: Tagcade\Legacy\Cache\Tag\RedisNamespacedCache
        arguments:
            - %tc.legacy.tag_cache.redis_host%
            - %tc.legacy.tag_cache.redis_port%

    tagcade.legacy.tag_cache:
        class: Tagcade\Legacy\TagCache
        arguments:
            - @tagcade.legacy.cache.tag.redis_namespace_cache
            - @tagcade.domain_manager.ad_slot

    tagcade_app.event_listener.adtag_change_listener:
        class: Tagcade\Bundle\AppBundle\EventListener\AdTagChangeListener
        arguments:
            - @event_dispatcher
        tags:
            - { name: doctrine.event_listener, event: onFlush }
            - { name: doctrine.event_listener, event: postFlush }

    tagcade_app.event_listener.adslot_change_listener:
        class: Tagcade\Bundle\AppBundle\EventListener\AdSlotChangeListener
        arguments:
            - @event_dispatcher
        tags:
            - { name: doctrine.event_listener, event: postPersist }
            - { name: doctrine.event_listener, event: postUpdate }

    tagcade_app.event_listener.adnetwork_change_listener:
        class: Tagcade\Bundle\AppBundle\EventListener\AdNetworkChangeListener
        arguments:
            - @event_dispatcher
        tags:
            - { name: doctrine.event_listener, event: postRemove }
            - { name: doctrine.event_listener, event: postUpdate }

    tagcade_app.event_listener.update_cache_listener:
        class: Tagcade\Bundle\AppBundle\EventListener\UpdateCacheListener
        arguments:
            - @tagcade.legacy.tag_cache
        tags:
            - { name: kernel.event_listener, event: tagcade_app.event.update_cache, method: onUpdateCache }

    tagcade_app.service.core.ad_tag.ad_tag_position_editor:
        class: Tagcade\Service\Core\AdTag\AdTagPositionEditor
        arguments:
            - @tagcade.domain_manager.ad_tag
            - @doctrine.orm.default_entity_manager

    tagcade_app.service.core.ad_network.ad_network_service:
        class: Tagcade\Service\Core\AdNetwork\AdNetworkService
        arguments:
            - @doctrine.orm.default_entity_manager