parameters:
    tagcade.service.reporting.report_util.class: Tagcade\Service\Reporting\ReportUtil
    tagcade.repository.source_report.report.class: Tagcade\Repository\Report\SourceReport\ReportRepositoryInterface

services:
    # legacy access to live performance report data

    redis_array.performance_report_data:
        class: RedisArray
        arguments:
            - %tc.legacy.live_performance_report.redis_hosts%

    tagcade.legacy.cache.performance_report_data:
        class: Tagcade\Legacy\Cache\RedisArrayCache
        calls:
            - [setRedis, [@redis_array.performance_report_data]]

    ###
    tagcade.service.report.performance_report.revenue_calculator:
        class: Tagcade\Service\Report\PerformanceReport\Display\RevenueCalculator

    ###
    tagcade.repository.source_report.report:
        class: %tagcade.repository.source_report.report.class%
        factory_service: doctrine.orm.entity_manager
        factory_method: getRepository
        arguments:
            - Tagcade\Entity\Report\SourceReport\Report

    tagcade.service.reporting.report_util:
        class: %tagcade.service.reporting.report_util.class%

    tagcade.service.report.source_report.report_selector:
        class: Tagcade\Service\Report\SourceReport\ReportSelector
        arguments:
            - @tagcade.repository.source_report.report
            - @tagcade.service.date_util

    ### Performance report creators

    tagcade.service.report.performance_report.display.creator.creators.hierarchy.platform.ad_tag:
        class: Tagcade\Service\Report\PerformanceReport\Display\Creator\Creators\Hierarchy\Platform\AdTag
        arguments:
            - @tagcade.service.report.performance_report.revenue_calculator

    tagcade.service.report.performance_report.display.creator.creators.hierarchy.platform.ad_slot:
        class: Tagcade\Service\Report\PerformanceReport\Display\Creator\Creators\Hierarchy\Platform\AdSlot
        arguments:
            - @tagcade.service.report.performance_report.display.creator.creators.hierarchy.platform.ad_tag

    tagcade.service.report.performance_report.display.creator.creators.hierarchy.platform.site:
        class: Tagcade\Service\Report\PerformanceReport\Display\Creator\Creators\Hierarchy\Platform\Site
        arguments:
            - @tagcade.service.report.performance_report.display.creator.creators.hierarchy.platform.ad_slot

    tagcade.service.report.performance_report.display.creator.creators.hierarchy.platform.account:
        class: Tagcade\Service\Report\PerformanceReport\Display\Creator\Creators\Hierarchy\Platform\Account
        arguments:
            - @tagcade.domain_manager.site
            - @tagcade.service.report.performance_report.display.creator.creators.hierarchy.platform.site

    tagcade.service.report.performance_report.display.creator.creators.hierarchy.platform.platform:
        class: Tagcade\Service\Report\PerformanceReport\Display\Creator\Creators\Hierarchy\Platform\Platform
        arguments:
            - @tagcade.service.report.performance_report.display.creator.creators.hierarchy.platform.account

    ###

    tagcade.service.report.performance_report.display.creator.creators.hierarchy.ad_network.ad_tag:
        class: Tagcade\Service\Report\PerformanceReport\Display\Creator\Creators\Hierarchy\AdNetwork\AdTag
        arguments:
            - @tagcade.service.report.performance_report.revenue_calculator

    tagcade.service.report.performance_report.display.creator.creators.hierarchy.ad_network.site:
        class: Tagcade\Service\Report\PerformanceReport\Display\Creator\Creators\Hierarchy\AdNetwork\Site
        arguments:
            - @tagcade.domain_manager.ad_tag
            - @tagcade.service.report.performance_report.display.creator.creators.hierarchy.ad_network.ad_tag

    tagcade.service.report.performance_report.display.creator.creators.hierarchy.ad_network.ad_network:
        class: Tagcade\Service\Report\PerformanceReport\Display\Creator\Creators\Hierarchy\AdNetwork\AdNetwork
        arguments:
            - @tagcade.domain_manager.site
            - @tagcade.service.report.performance_report.display.creator.creators.hierarchy.ad_network.site

    ###

    tagcade.service.report.performance_report.display.counter.cache_event_counter:
        class: Tagcade\Service\Report\PerformanceReport\Display\Counter\CacheEventCounter
        arguments:
            - @tagcade.legacy.cache.performance_report_data

    ### Report creator service

    tagcade.service.report.performance_report.display.creator.report_creator:
        class: Tagcade\Service\Report\PerformanceReport\Display\Creator\ReportCreator
        arguments:
            -
                # platform hierarchy
                - @tagcade.service.report.performance_report.display.creator.creators.hierarchy.platform.ad_tag
                - @tagcade.service.report.performance_report.display.creator.creators.hierarchy.platform.platform
                - @tagcade.service.report.performance_report.display.creator.creators.hierarchy.platform.account
                - @tagcade.service.report.performance_report.display.creator.creators.hierarchy.platform.site
                - @tagcade.service.report.performance_report.display.creator.creators.hierarchy.platform.ad_slot
                # ad network hierarchy
                - @tagcade.service.report.performance_report.display.creator.creators.hierarchy.ad_network.ad_tag
                - @tagcade.service.report.performance_report.display.creator.creators.hierarchy.ad_network.site
                - @tagcade.service.report.performance_report.display.creator.creators.hierarchy.ad_network.ad_network
            - @tagcade.service.report.performance_report.display.counter.cache_event_counter

    ### Performance report repositories

    tagcade.repository.report.performance_report.display.hierarchy.platform.platform:
        class: Tagcade\Repository\Report\PerformanceReport\Display\Hierarchy\Platform\PlatformReportRepositoryInterface
        factory_service: doctrine.orm.entity_manager
        factory_method: getRepository
        arguments:
            - Tagcade\Entity\Report\PerformanceReport\Display\Platform\PlatformReport

    tagcade.repository.report.performance_report.display.hierarchy.platform.account:
        class: Tagcade\Repository\Report\PerformanceReport\Display\Hierarchy\Platform\AccountReportRepositoryInterface
        factory_service: doctrine.orm.entity_manager
        factory_method: getRepository
        arguments:
            - Tagcade\Entity\Report\PerformanceReport\Display\Platform\AccountReport

    tagcade.repository.report.performance_report.display.hierarchy.platform.site:
        class: Tagcade\Repository\Report\PerformanceReport\Display\Hierarchy\Platform\SiteReportRepositoryInterface
        factory_service: doctrine.orm.entity_manager
        factory_method: getRepository
        arguments:
            - Tagcade\Entity\Report\PerformanceReport\Display\Platform\SiteReport

    tagcade.repository.report.performance_report.display.hierarchy.platform.ad_slot:
        class: Tagcade\Repository\Report\PerformanceReport\Display\Hierarchy\Platform\AdSlotReportRepositoryInterface
        factory_service: doctrine.orm.entity_manager
        factory_method: getRepository
        arguments:
            - \Tagcade\Entity\Report\PerformanceReport\Display\Platform\AdSlotReport

    tagcade.repository.report.performance_report.display.hierarchy.platform.ad_tag:
        class: Tagcade\Repository\Report\PerformanceReport\Display\Hierarchy\Platform\AdTagReportRepositoryInterface
        factory_service: doctrine.orm.entity_manager
        factory_method: getRepository
        arguments:
            - \Tagcade\Entity\Report\PerformanceReport\Display\Platform\AdTagReport

    ###

    tagcade.repository.report.performance_report.display.hierarchy.ad_network.ad_network:
        class: Tagcade\Repository\Report\PerformanceReport\Display\Hierarchy\AdNetwork\AdNetworkReportRepositoryInterface
        factory_service: doctrine.orm.entity_manager
        factory_method: getRepository
        arguments:
            - \Tagcade\Entity\Report\PerformanceReport\Display\AdNetwork\AdNetworkReport

    tagcade.repository.report.performance_report.display.hierarchy.ad_network.site:
        class: Tagcade\Repository\Report\PerformanceReport\Display\Hierarchy\AdNetwork\SiteReportRepositoryInterface
        factory_service: doctrine.orm.entity_manager
        factory_method: getRepository
        arguments:
            - \Tagcade\Entity\Report\PerformanceReport\Display\AdNetwork\SiteReport

    tagcade.repository.report.performance_report.display.hierarchy.ad_network.ad_tag:
        class: Tagcade\Repository\Report\PerformanceReport\Display\Hierarchy\AdNetwork\AdTagReportRepositoryInterface
        factory_service: doctrine.orm.entity_manager
        factory_method: getRepository
        arguments:
            - \Tagcade\Entity\Report\PerformanceReport\Display\AdNetwork\AdTagReport

    ### Performance report selectors

    tagcade.service.report.performance_report.display.selector.selectors.hierarchy.platform.platform:
        class: Tagcade\Service\Report\PerformanceReport\Display\Selector\Selectors\Hierarchy\Platform\Platform
        arguments:
            - @tagcade.repository.report.performance_report.display.hierarchy.platform.platform

    tagcade.service.report.performance_report.display.selector.selectors.hierarchy.platform.account:
        class: Tagcade\Service\Report\PerformanceReport\Display\Selector\Selectors\Hierarchy\Platform\Account
        arguments:
            - @tagcade.repository.report.performance_report.display.hierarchy.platform.account

    tagcade.service.report.performance_report.display.selector.selectors.hierarchy.platform.site:
        class: Tagcade\Service\Report\PerformanceReport\Display\Selector\Selectors\Hierarchy\Platform\Site
        arguments:
            - @tagcade.repository.report.performance_report.display.hierarchy.platform.site

    tagcade.service.report.performance_report.display.selector.selectors.hierarchy.platform.ad_slot:
        class: Tagcade\Service\Report\PerformanceReport\Display\Selector\Selectors\Hierarchy\Platform\AdSlot
        arguments:
            - @tagcade.repository.report.performance_report.display.hierarchy.platform.ad_slot

    tagcade.service.report.performance_report.display.selector.selectors.hierarchy.platform.ad_tag:
        class: Tagcade\Service\Report\PerformanceReport\Display\Selector\Selectors\Hierarchy\Platform\AdTag
        arguments:
            - @tagcade.repository.report.performance_report.display.hierarchy.platform.ad_tag

    ###

    tagcade.service.report.performance_report.display.selector.selectors.hierarchy.ad_network.ad_network:
        class: Tagcade\Service\Report\PerformanceReport\Display\Selector\Selectors\Hierarchy\AdNetwork\AdNetwork
        arguments:
            - @tagcade.repository.report.performance_report.display.hierarchy.ad_network.ad_network

    tagcade.service.report.performance_report.display.selector.selectors.hierarchy.ad_network.site:
        class: Tagcade\Service\Report\PerformanceReport\Display\Selector\Selectors\Hierarchy\AdNetwork\Site
        arguments:
            - @tagcade.repository.report.performance_report.display.hierarchy.ad_network.site

    tagcade.service.report.performance_report.display.selector.selectors.hierarchy.ad_network.ad_tag:
        class: Tagcade\Service\Report\PerformanceReport\Display\Selector\Selectors\Hierarchy\AdNetwork\AdTag
        arguments:
            - @tagcade.repository.report.performance_report.display.hierarchy.ad_network.ad_tag

    ### Report selector service

    tagcade.service.report.performance_report.display.creator.report_selector:
        class: Tagcade\Service\Report\PerformanceReport\Display\Selector\ReportSelector
        arguments:
            -
                # platform selectors
                - @tagcade.service.report.performance_report.display.selector.selectors.hierarchy.platform.platform
                - @tagcade.service.report.performance_report.display.selector.selectors.hierarchy.platform.account
                - @tagcade.service.report.performance_report.display.selector.selectors.hierarchy.platform.site
                - @tagcade.service.report.performance_report.display.selector.selectors.hierarchy.platform.ad_slot
                - @tagcade.service.report.performance_report.display.selector.selectors.hierarchy.platform.ad_tag
                # ad network selectors
                - @tagcade.service.report.performance_report.display.selector.selectors.hierarchy.ad_network.ad_network
                - @tagcade.service.report.performance_report.display.selector.selectors.hierarchy.ad_network.site
                - @tagcade.service.report.performance_report.display.selector.selectors.hierarchy.ad_network.ad_tag
            - @tagcade.service.date_util
            - @tagcade.service.report.performance_report.display.creator.report_creator
